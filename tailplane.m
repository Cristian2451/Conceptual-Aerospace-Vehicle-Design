clear
clc

%importing wing data
CL = [0	0.00754834669910484	0.0150782787362992	0.0225772365812054	0.0300355348565791	0.0374452286637029	0.0447997331951012	0.0520935476446402	0.0593220878989372	0.0664815553454402	0.0735688326587679	0.0805814045774107	0.0875172806911189	0.0943749422251724	0.101153279029011	0.107851552458416	0.114469340917297	0.121006514274944	0.127463185036454	0.133839691883495	0.140136554734604	0.146354465980422	0.152494248261293	0.158556852463508	0.164543317332070	0.170454773568924	0.176292404557641	0.182057456072689	0.187751197485529	0.193374936709073	0.198929981312347	0.204417658412568	0.209839275163291	0.215196143381157	0.220489538897673	0.225720730775616	0.230890939030554	0.236001368356836	0.241053163732978	0.246047448641296	0.250985278071352	0.255867681282129	0.260695611709329	0.265469994385727	0.270191672240220	0.274861458361905	0.279480078150050	0.284048226681978	0.288566506131757	0.293035488582983	0.297455648077702	0.301827429304958	0.306151173567366	0.310427193877662	0.314655694034702	0.318836850776926	0.322970725037280	0.327057351939303	0.331096643144850	0.335088485641616	0.339032633899466	0.342928818595844	0.346776627043502	0.350575623243378	0.354325214721165	0.358024785600817	0.361673547565196	0.365270688027968	0.368815202379318	0.372306059828565	0.375742013358204	0.379121786455523	0.382443856200217	0.385706664961028	0.388908370666491	0.392047088702415	0.395120601477269	0.398126637356340	0.401062528833400	0.403925537594934	0.406712446444237	0.409419942857167	0.412044123389434	0.414580952957778	0.417025650164215	0.419373247054448	0.421617806416420	0.423753118844093	0.425771671865256	0.427665541484564	0.429424972351876	0.431039557223752	0.432496156533765	0.433780528174674	0.434873988398503	0.435755793908431	0.436396933868491	0.436763841047524	0.436803153446434	0.436447128696947	0.435533885829312];
CLmean = 0.273126672739716;
y_s = [14.0675159920139	14.0657805174768	14.0605745220677	14.0518992902883	14.0397569626220	14.0241505350066	14.0050838580946	13.9825616363032	13.9565894266535	13.9271736373998	13.8943215264478	13.8580411995643	13.8183416083772	13.7752325481665	13.7287246554478	13.6788294053476	13.6255591087724	13.5689269093707	13.5089467802904	13.4456335207307	13.3790027522911	13.3090709151167	13.2358552638419	13.1593738633331	13.0796455842315	12.9966900982969	12.9105278735541	12.8211801692430	12.7286690305725	12.6330172832819	12.5342485280086	12.4323871344649	12.3274582354257	12.2194877205265	12.1085022298764	11.9945291474846	11.8775965945035	11.7577334222911	11.6349692052914	11.5093342337382	11.3808595061806	11.2495767218353	11.1155182727650	10.9787172358859	10.8392073648069	10.6970230815012	10.5521994678131	10.4047722568024	10.2547778239271	10.1022531780694	9.94723595240324	9.78976439510950	9.62987735993867	9.46761429662421	9.30301524114902	9.13612080586708	8.96697216948300	8.79561106689179	8.62207977888138	8.44642112170047	8.26867843649429	8.08889557861081	7.90711690678004	7.72338727216926	7.53775200731659	7.35025691494593	7.16094825666575	6.96987274155481	6.77707751463734	6.58261014525071	6.38651861530846	6.18885130746141	5.98965699316001	5.78898482062072	5.58688430269937	5.38340530467467	5.17859803194468	4.97251301763932	4.76520111015217	4.55671346059432	4.34710151017365	4.13641697750241	3.92471184583651	3.71203835024937	3.49844896474373	3.28399638930446	3.06873353689561	2.85271352040499	2.63598963953927	2.41861536767316	2.20064433865559	1.98213033357641	1.76312726749666	1.54368917614591	1.32387020258966	1.10372458387041	0.883306637625480	0.662670748684913	0.441871355652867	0.220962937475674	8.61386921578702e-16];
c = [0.942240014388441	0.943625360853889	0.945933891833721	0.949165037732462	0.953318001313209	0.958391757894342	0.964385055602344	0.971296415680685	0.979124132854683	0.987866275752254	0.997520687380450	1.00808498565766	1.01955656400137	1.03193259197127	1.04521001596764	1.05938555998479	1.07445572641935	1.09041679693325	1.10726483337117	1.12499567873221	1.14360495819561	1.16308808020011	1.18344023757688	1.20465640873564	1.22673135890360	1.24965964141714	1.27343559906562	1.29805336548726	1.32350686661657	1.34978982218300	1.37689574726056	1.40481795386781	1.43354955261810	1.46308345441934	1.49341237222321	1.52452882282304	1.55642512870026	1.58909341991867	1.62252563606623	1.65671352824387	1.69164866110077	1.72732241491562	1.76372598772348	1.80085039748747	1.83868648431499	1.87722491271777	1.91645617391526	1.95637058818079	1.99695830722990	2.03820931665023	2.08011343837246	2.12266033318159	2.16583950326796	2.20964029481746	2.25405190064017	2.29906336283691	2.34466357550290	2.39084128746799	2.43758510507273	2.48488349497957	2.53272478701854	2.58109717706670	2.62998872996060	2.67938738244116	2.72928094613004	2.77965711053698	2.83050344609720	2.88180740723823	2.93355633547534	2.98573746253483	3.03833791350439	3.09134471000982	3.14474477341725	3.19852492806007	3.25267190448986	3.30717234275039	3.36201279567404	3.41717973219963	3.47265954071107	3.52843853239577	3.58450294462216	3.64083894433544	3.69743263147065	3.75427004238233	3.81133715328980	3.86861988373737	3.92610410006844	3.98377561891277	4.04162021068606	4.09962360310082	4.15777148468792	4.21604950832764	4.27444329478969	4.33293843628103	4.39152050000077	4.45017503170127	4.50888755925450	4.56764359622283	4.62642864543331	4.68522820255467];
b = 28.135031984027815;
mac = 3.228567532096122;
sweep_c4 = 18.4;
twist = -4.242424242424242;
aerofoil_ac = 0.265; %Re = 9e6
[M,I] = min(abs(CL-CLmean));
xac = (b/2 - y_s(I))*sind(sweep_c4) + aerofoil_ac*c(I);
Srefw
Srefh
AR = 10;

%% Clean Cruise Moment Calcs

%wing contribution
Cm0 = -0.3; %aerofoil pitching moment coeff
dCm0de = -0.006;
dCmMdCm = 1.2;
Cmw = (Cm0*AR*cosd(sweep_c4)^2/(AR+2*cosd(sweep_c4)) + dCm0de*twist)*dCmMdCm;
CLw = CLmean;   %CL for level cruise flight

%fuselage contribution
Kfus = 0.017;   %empirical pitching-moment factor interpolated value from fig 16.14 in Raymer
Wf = 2.546;     %width of fuselage
Lf = 28;        %length of fuselage
dCmfus_dalpha = Kfus*Wf^2*Lf/(mac*Srefw);   %fuselage moment coefficient per deg
aw =    %lift curve slope of wing

%engine contribution
z = ???    %vertical position of engines
T = 2*
Cme = -T*z/(0.5*rho*Vi^2*mac*Srefw);

%tailplane contribution
Cmh = ???
CLh = -0.5; %assumption to ensure negative lift contrib from tailplane and tailplane not stalled
lh = ???    %longitudinal position of tailplane c/4
etah = 0.9; %dynamic pressure ratio estimate
ah =    %lift curve slope of tailplane

%downwash estimation
ka = 1/AR - 1/(1+AR^1.7);
klambda = (10 - 3*taper)/7;
kh = (1 - abs(zh/b))/(2*lh/b)^(1/3);
dCLMdCL = 
dedalpha = 4.44*(ka*klambda*kh*sqrt(cosd(sweep_c4)))^(1.19)*dCLMdCL

delta1 = 
delta2 = 
downwash = (CLw/(pi*AR))*((1-CLw/sqrt(CLw^2+1))*delta1 + (CLw/sqrt(CLw^2+1))*delta2);

%control requirement
x_ = (xcg - xac)/mac;
a = (CL/(CLh*etah*lh/mac));
b = (Cmw+Cme)/(CLh*etah*lh/mac);
ShSref = a*x_ + b;

%stability requirement
Kn = 0.05;  %required static margin for jet transport
x = x_ + Kn;
ShSref = aw*x/(ah*etah*(1-dedalpha)*(lh/mac - x));

%% Critical flight:  landing approach, maximum flap position, foremost COG position.